/*! angular-hue-service 28-03-2015 */
"use strict";angular.module("hue",[]).service("hue",["$http","$q","$log",function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;e={username:"",apiUrl:"",bridgeIP:""},g=!1,o=function(){var a;return a=b.defer(),g?(a.resolve(),a.promise):""===e.username?(c.error("Error in setup: Username has to be set"),a.reject,a.promise):""!==e.apiUrl?(g=!0,a.resolve(),a.promise):(""!==e.bridgeIP?(e.apiUrl=d(),g=!0,a.resolve()):f().then(function(b){return null!=b[0]?(e.bridgeIP=b[0].internalipaddress,e.apiUrl=d(),g=!0,a.resolve()):(c.error("Error in setup: Returned data from nupnp is empty. Is there a hue bridge present in this network?"),a.reject)},function(b){return c.error("Error in setup: "+b),a.reject}),a.promise)},m=function(d,e,f){var g;return g=b.defer(),a.put(e,f).success(function(a){return n(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},l=function(d,e,f){var g;return g=b.defer(),a.post(e,f).success(function(a){return n(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},j=function(d,e){var f;return f=b.defer(),a["delete"](e).success(function(a){return n(d,a,f)}).error(function(a){return c.error("Error: "+d,a),f.reject}),f.promise},k=function(d,e){var f;return f=b.defer(),a.get(e).success(function(a){return n(d,a,f)}).error(function(a){return c.error(""+d,a),f.reject}),f.promise},n=function(a,b,d){return null!=b[0]&&b[0].error?(c.error(""+a,b),d.reject):(c.debug("Response of "+a+":",b),d.resolve(b))},i=function(a){var b,c,d,f;for(null==a&&(a=[]),c=e.apiUrl,d=0,f=a.length;f>d;d++)b=a[d],c+="/"+b;return c},h=function(a,b,d){var e,f;switch(null==b&&(b=[]),null==d&&(d=null),e=a+b.join("/"),f=i(b),a){case"get":return k(e,f);case"post":return l(e,f,d);case"put":return m(e,f,d);case"delete":return j(e,f);default:return c.error("unsupported method "+a)}},f=function(){return k("getBridgeNupnp","https://www.meethue.com/api/nupnp")},d=function(){return"http://"+e.bridgeIP+"/api/"+e.username},this.getBridgeIP=function(){return o().then(function(){return e.bridgeIP})},this.setup=function(a){return null==a&&(a={}),angular.extend(e,a)},this.getLights=function(){return o().then(function(){return h("get",["lights"])})},this.getNewLights=function(){return o().then(function(){return h("get",["lights","new"])})},this.searchNewLights=function(){return o().then(function(){return h("post",["lights"],{})})},this.getLight=function(a){return o().then(function(){return h("get",["lights",a])})},this.setLightName=function(a,b){return o().then(function(){return h("put",["lights",a],{name:b})})},this.setLightState=function(a,b){return o().then(function(){return h("put",["lights",a,"state"],b)})},this.getConfiguration=function(){return o().then(function(){return h("get",["config"])})},this.setConfiguration=function(a){return o().then(function(){return h("put",["config"],a)})},this.createUser=function(a,b){return null==b&&(b=!1),o().then(function(){var c;return c={devicetype:a},b&&(c.username=b),h("post",["api"],c)})},this.deleteUser=function(a){return o().then(function(){return h("delete",["config","whitelist",a])})},this.getFullState=function(){return o().then(function(){return h("get")})},this.getGroups=function(){return o().then(function(){return h("get",["groups"])})},this.createGroup=function(a,b){return o().then(function(){var d;return d={lights:b,name:a},c.debug("Debug: createGroup body",d),h("post",["groups"],d)})},this.getGroupAttributes=function(a){return o().then(function(){return h("get",["groups",a])})},this.setGroupAttributes=function(a,b,c){return o().then(function(){var d;return d={lights:c,name:b},h("put",["groups",a],d)})},this.setGroupState=function(a,b){return o().then(function(){return h("put",["groups",a,"action"],b)})},this.deleteGroup=function(a){return o().then(function(){return h("delete",["groups",a])})},this.getRules=function(){return o().then(function(){return h("get",["rules"])})},this.getRule=function(a){return o().then(function(){return h("get",["rules",a])})},this.createRule=function(a,b,c){return o().then(function(){var d;return d={name:a,conditions:b,actions:c},h("post",["rules"],d)})},this.updateRule=function(a,b,d,e){return null==b&&(b=!1),null==d&&(d=!1),null==e&&(e=!1),o().then(function(){var a;return a={},b&&(a.name=b),d&&(a.conditions=d),e&&(a.actions=e),c.debug("Debug: updateRule body",a),h("put",["rules"],a)})},this.deleteRule=function(a){return o().then(function(){return h("delete",["rules",a])})},this.getSchedules=function(){return o().then(function(){return h("get",["schedules"])})},this.createSchedule=function(a,b,c,d,e,f){return null==a&&(a="schedule"),null==b&&(b=""),null==e&&(e="enabled"),null==f&&(f=!1),o().then(function(){var g;return g={name:a,description:b,command:c,time:d,status:e,autodelete:f},h("post",["schedules"],g)})},this.getScheduleAttributes=function(a){return o().then(function(){return h("get",["schedules",a])})},this.setScheduleAttributes=function(a,b,c,d,e,f,g){return null==b&&(b=null),null==c&&(c=null),null==d&&(d=null),null==e&&(e=null),null==f&&(f=null),null==g&&(g=null),o().then(function(){var e;return e={},b&&(e.name=b),c&&(e.description=c),d&&(e.command=d),f&&(e.status=f),null!==g&&(e.autodelete=g),h("put",["schedules",a],e)})},this.deleteSchedule=function(a){return o().then(function(){return h("delete",["schedules",a])})},this.getScenes=function(){return o().then(function(){return h("get",["scenes"])})},this.createScene=function(a,b,c){return o().then(function(){var d;return d={name:b,lights:c},h("put",["scenes",a],d)})},this.updateScene=function(a,b,c){return o().then(function(){return h("put",["scenes",a,"lights",b,"state"],c)})},this.getSensors=function(){return o().then(function(){return h("get",["sensors"])})},this.createSensor=function(a,b,c,d,e,f,g,i){return null==g&&(g=null),null==i&&(i=null),o().then(function(){var j;return j={name:a,modelid:b,swversion:c,type:d,uniqueid:e,manufacturername:f},g&&(j.state=g),i&&(j.config=i),h("post",["sensors"],j)})},this.searchNewSensors=function(){return o().then(function(){return h("post",["sensors"],null)})},this.getNewSensors=function(){return o().then(function(){return h("get",["sensors","new"])})},this.getSensor=function(a){return o().then(function(){return h("get",["sensors",a])})},this.renameSensor=function(a,b){return o().then(function(){var c;return c={name:b},h("put",["sensors",a],c)})},this.updateSensor=function(a,b){return o().then(function(){return h("put",["sensors",a,"config"],b)})},this.setSensorState=function(a,b){return o().then(function(){return h("put",["sensors",a,"state"],b)})},this.getTimezones=function(){return o().then(function(){return h("get",["info","timezones"])})},this.setEffect=function(a,b){return null==b&&(b="none"),setLightState(a,{effect:b})},this.setAlert=function(a,b){return null==b&&(b="none"),setLightState(a,{alert:b})},this.setBrightness=function(a,b){return setLightState(a,{bri:b})}}]);